<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Food Admin</title>
  <style>
    body { font-family: Arial; margin: 20px; background: #f4f4f4; }
    form, table { background: white; padding: 20px; border-radius: 10px; }
    input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
    button { padding: 10px; margin-top: 10px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    img { height: 50px; }
  </style>
</head>
<body>
	<button id="backBtn" onclick="window.location.href='/ADMIN'" sstyle="background-color: #007BFF; color: white; border: none; padding: 10px 15px; margin-bottom: 20px; cursor: pointer; border-radius: 4px;">
							        &#8592; GO TO Admin Panel
							    </button>
<h2>Add Food</h2>
<form id="addFoodForm">
  <input type="text" id="name" placeholder="Name" required>
  <input type="number" id="price" placeholder="Price" required>
  <input type="text" id="category" placeholder="Category" required>
  <textarea id="description" placeholder="Description" required></textarea>
  <input type="file" id="image">
  <button type="submit">Add Food</button>
</form>

<h2>Edit Food</h2>
<form id="editForm" style="display:none;">
  <input type="text" id="editName" placeholder="Name" required>
  <input type="number" id="editPrice" placeholder="Price" required>
  <input type="text" id="editCategory" placeholder="Category" required>
  <textarea id="editDescription" placeholder="Description" required></textarea>
  <input type="file" id="editImage">
  <button type="submit">Update</button>
</form>

<table>
  <thead>
    <tr>
      <th>ID</th><th>Name</th><th>Price</th><th>Category</th><th>Description</th><th>Image</th><th>Actions</th>
    </tr>
  </thead>
  <tbody id="menuBody"></tbody>
</table>

<script>
  let currentId = null;

  // Load items
  function loadMenu() {
    fetch("http://localhost:8080/api/food/list")
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById("menuBody");
        tbody.innerHTML = "";
        data.forEach(item => {
          const row = `
            <tr>
              <td>${item.id}</td>
              <td>${item.name}</td>
              <td>${item.price}</td>
              <td>${item.category}</td>
              <td>${item.description}</td>
              <td><img src="http://localhost:8080${item.image_url}" alt="${item.name}"/></td>
              <td>
                <button onclick="editItem(${item.id})">Edit</button>
                <button onclick="deleteItem(${item.id})" style="background:red;">Delete</button>
              </td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      })
      .catch(error => {
        console.error("Error loading menu:", error);
      });
  }

  // Add item
  document.getElementById('addFoodForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData();
    formData.append("name", document.getElementById("name").value);
    formData.append("price", document.getElementById("price").value);
    formData.append("category", document.getElementById("category").value);
    formData.append("description", document.getElementById("description").value);
    const image = document.getElementById("image").files[0];
    if (image) formData.append("image", image);

    fetch("http://localhost:8080/api/food/add", {
      method: "POST",
      body: formData
    })
    .then(res => res.text())
    .then(msg => {
      alert(msg);
      document.getElementById('addFoodForm').reset();
      loadMenu();
    })
    .catch(error => {
      console.error("Error adding food:", error);
      alert("Error adding food item");
    });
  });

  // Edit item - fill form
  function editItem(id) {
    fetch(`http://localhost:8080/api/food/get/${id}`)
      .then(res => res.json())
      .then(item => {
        currentId = id;
        document.getElementById('editName').value = item.name;
        document.getElementById('editPrice').value = item.price;
        document.getElementById('editCategory').value = item.category;
        document.getElementById('editDescription').value = item.description;
        document.getElementById('editForm').style.display = "block";
        // Scroll to edit form
        document.getElementById('editForm').scrollIntoView({behavior: 'smooth'});
      })
      .catch(error => {
        console.error("Error fetching food item:", error);
        alert("Error fetching food item details");
      });
  }

  // Update item
  document.getElementById('editForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const formData = new FormData();
    formData.append("name", document.getElementById("editName").value);
    formData.append("price", document.getElementById("editPrice").value);
    formData.append("category", document.getElementById("editCategory").value);
    formData.append("description", document.getElementById("editDescription").value);
    const newImg = document.getElementById("editImage").files[0];
    if (newImg) formData.append("image", newImg);

    fetch(`http://localhost:8080/api/food/update/${currentId}`, {
      method: "PUT",
      body: formData
    })
    .then(res => res.text())
    .then(msg => {
      alert(msg);
      document.getElementById('editForm').reset();
      document.getElementById('editForm').style.display = "none";
      currentId = null;
      loadMenu();
    })
    .catch(error => {
      console.error("Error updating food:", error);
      alert("Error updating food item");
    });
  });

  // Delete item
  function deleteItem(id) {
    if (confirm("Are you sure you want to delete this item?")) {
      fetch(`http://localhost:8080/api/food/delete/${id}`, {
        method: "DELETE"
      })
      .then(res => {
        if (!res.ok) {
          throw new Error("Server responded with status: " + res.status);
        }
        return res.text();
      })
      .then(msg => {
        alert(msg);
        loadMenu();
      })
      .catch(error => {
        console.error("Error deleting food:", error);
        alert("Error deleting food item: " + error.message);
      });
    }
  }

  // Initialize page
  loadMenu();
</script>

</body>
</html>